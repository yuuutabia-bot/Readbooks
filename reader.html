<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Scroll Book Reader</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: white;
}

header {
  background: #202124;
  padding: 15px;
  text-align: center;
  font-size: 18px;
  position: sticky;
  top: 0;
  z-index: 1000;
}

#pdf-container {
  display: flex;
  flex-direction: column;
  align-items: center;
}

canvas {
  margin: 15px 0;
  background: white;
  max-width: 95%;
}

#loader {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border: 6px solid #333;
  border-top: 6px solid #4f46e5;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Popup Iklan */
#ad-popup {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #222;
  padding: 20px;
  border-radius: 10px;
  display: none;
  z-index: 2000;
  max-width: 250px;
}

#ad-popup button {
  margin-top: 10px;
  padding: 5px 10px;
  border: none;
  cursor: pointer;
}
</style>
</head>

<body>

<header>
ðŸ“– Scroll Mode Reader
</header>

<div id="loader"></div>
<div id="pdf-container"></div>

<!-- Popup Iklan -->
<div id="ad-popup">
ðŸ”¥ Iklan Spesial!<br><br>
Tempatkan Google AdSense di sini ðŸ’°
<br>
<button onclick="closeAd()">Tutup</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

<script>
const urlParams = new URLSearchParams(window.location.search);
const book = urlParams.get("book");
const url = "books/" + book;

let pdfDoc = null;
let scale = 1.1;
let lastAdPage = 0;

const container = document.getElementById("pdf-container");
const loader = document.getElementById("loader");
const popup = document.getElementById("ad-popup");

pdfjsLib.getDocument(url).promise.then(pdf => {
  pdfDoc = pdf;
  renderAllPages();
});

function renderAllPages() {

  for (let pageNum = 1; pageNum <= pdfDoc.numPages; pageNum++) {

    pdfDoc.getPage(pageNum).then(page => {

      const viewport = page.getViewport({ scale });
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");

      canvas.height = viewport.height;
      canvas.width = viewport.width;

      container.appendChild(canvas);

      page.render({
        canvasContext: ctx,
        viewport: viewport
      }).promise.then(() => {
        loader.style.display = "none";
      });

    });
  }

  restoreScroll();
}

/* SAVE LAST PAGE + AUTO AD */
window.addEventListener("scroll", () => {

  const canvases = document.querySelectorAll("canvas");

  canvases.forEach((canvas, index) => {

    const rect = canvas.getBoundingClientRect();

    if (rect.top >= 0 && rect.top < window.innerHeight / 2) {

      const currentPage = index + 1;

      localStorage.setItem("lastPage_" + book, currentPage);

      if (currentPage % 5 === 0 && lastAdPage !== currentPage) {
        lastAdPage = currentPage;
        showAd();
      }
    }

  });

});

/* Restore Scroll Position */
function restoreScroll() {
  const savedPage = localStorage.getItem("lastPage_" + book);

  if (savedPage) {
    setTimeout(() => {
      const target = document.querySelectorAll("canvas")[savedPage - 1];
      if (target) target.scrollIntoView();
    }, 1200);
  }
}

function showAd() {
  popup.style.display = "block";
}

function closeAd() {
  popup.style.display = "none";
}
</script>

</body>
</html>
